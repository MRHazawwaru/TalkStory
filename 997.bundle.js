"use strict";(self.webpackChunkTalkStory=self.webpackChunkTalkStory||[]).push([[997],{715:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(642);const s={register:async(e,t,a)=>(await fetch(`${i.A.BASE_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:a})})).json(),login:async(e,t)=>(await fetch(`${i.A.BASE_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})).json(),getStories:async e=>(await fetch(`${i.A.BASE_URL}/stories`,{headers:{Authorization:`Bearer ${e}`}})).json(),async addStory({token:e,description:t,image:a,lat:s,lon:n}){const o=new FormData;return o.append("description",t),o.append("photo",a),s&&n&&(o.append("lat",s),o.append("lon",n)),(await fetch(`${i.A.BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:o})).json()}}},815:(e,t,a)=>{async function i(e,t){try{const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`,i=await fetch(a,{headers:{"User-Agent":"TalkStoryApp/1.0"}}),s=(await i.json()).address||{};return`${s.village||s.town||s.city||""}, ${s.state||s.region||""}`}catch{return"Tanpa Lokasi"}}a.d(t,{p:()=>i})},997:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r}),a(465);var i=a(715);let s;const n=()=>{s&&(s.getTracks().forEach((e=>e.stop())),s=null)};var o=a(815);class r{constructor(e){this.view=e,this.init()}async init(){await this.view.render(),await function(e,t=3e3){return new Promise(((a,i)=>{let s=0;const n=setInterval((()=>{const o=document.querySelector(e);o&&(clearInterval(n),a(o)),s+=50,s>=t&&(clearInterval(n),i(new Error(`Element ${e} not found after ${t}ms`)))}),50)}))}("#map"),this.view.renderMap(this.handleMapClick.bind(this)),this.view.bindEvents({onSubmit:this.handleSubmit.bind(this),onCancel:this.handleCancel.bind(this),onOptionSelect:this.handleOptionSelect.bind(this),onCapture:this.handleCapture.bind(this),onFileUpload:this.handleUpload.bind(this)}),this.video=this.view.getVideoElement()}async handleOptionSelect(e){if("camera"===e){if(await this.view.showConfirmDialog("Aktifkan Kamera?","Izinkan aplikasi menggunakan kamera untuk ambil foto."))try{await(async e=>{try{s=await navigator.mediaDevices.getUserMedia({video:!0}),e.srcObject=s}catch(e){throw console.error("Gagal mengakses kamera:",e),new Error("Tidak bisa mengakses kamera. Pastikan izin telah diberikan.")}})(this.video),this.view.toggleCamera(!0)}catch(e){this.view.showAlert("Gagal",e.message,"error")}}else n(),this.view.toggleCamera(!1)}async handleCapture(){const e=await this.view.captureImage(this.video);this.view.setCapturedImage(e),await this.view.showAlert("Berhasil","Foto berhasil diambil","success")}async handleMapClick(e){const{lat:t,lng:a}=e;this.view.updateLatLon(t,a);const i=await(0,o.p)(t,a);this.view.addMarkerToMap(e,i||"Lokasi dipilih")}handleUpload(e){this.view.setUploadedImage(e)}async handleSubmit({description:e,lat:t,lon:a,image:s}){try{const n=localStorage.getItem("token");if(!n)throw new Error("User belum login");await i.A.addStory({token:n,description:e,image:s,lat:t,lon:a}),await this.view.showAlert("Sukses","Cerita berhasil dikirim!","success"),this.view.navigateToStoryList()}catch(e){this.view.showAlert("Gagal",e.message,"error")}finally{n()}}handleCancel(){n(),this.view.navigateToStoryList()}destroy(){n()}}}}]);