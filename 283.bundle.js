"use strict";(self.webpackChunkTalkStory=self.webpackChunkTalkStory||[]).push([[283],{283:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var a=s(715),n=s(465),i=s.n(n);const o=(e,t,s="info")=>{i().fire({title:e,text:t,icon:s})};class r{constructor(e){this.view=e,this.init()}async init(){await this.view.render(),function(){const e=document.querySelector("#sign-in-btn"),t=document.querySelector("#sign-up-btn"),s=document.querySelector(".container");t&&e&&s&&(t.addEventListener("click",(()=>{s.classList.add("sign-up-mode")})),e.addEventListener("click",(()=>{s.classList.remove("sign-up-mode")})));const a=document.getElementsByTagName("html")[0],n=localStorage.getItem("theme");n&&(a.dataset.theme=n),window.toggleTheme=e=>{a.dataset.theme=e,localStorage.setItem("theme",e)};const i=document.querySelector("#togglePassword"),o=document.querySelector("#id_password");i&&o&&i.addEventListener("click",(()=>{const e="password"===o.type?"text":"password";o.type=e,i.classList.toggle("fa-eye-slash")}));const r=document.querySelector("#toggleReg"),l=document.querySelector("#id_reg");r&&l&&r.addEventListener("click",(()=>{const e="password"===l.type?"text":"password";l.type=e,r.classList.toggle("fa-eye-slash")}))}(),this.view.bindLoginForm(this.handleLogin.bind(this)),this.view.bindRegisterForm(this.handleRegister.bind(this)),this.view.bindSubscribeClick()}bindSubscribeClick(){const e=document.getElementById("subscribe-btn-auth");e&&e.addEventListener("click",(()=>{Swal.fappire("Silakan login terlebih dahulu untuk berlangganan","","info")}))}async handleLogin({email:e,password:t}){try{this.view.setButtonLoading("login-btn",!0);const s=await a.A.login(e,t);s.error?o("Login Gagal",s.message,"error"):(localStorage.setItem("token",s.loginResult.token),await o("Login Berhasil","Selamat datang!","success"),location.hash="/story-list")}catch(e){o("Kesalahan","Gagal menghubungi server","error")}finally{this.view.setButtonLoading("login-btn",!1)}}async handleRegister({name:e,email:t,password:s}){try{this.view.setButtonLoading("register-btn",!0);const n=await a.A.register(e,t,s);n.error?o("Registrasi Gagal",n.message,"error"):(await o("Registrasi Berhasil","Silakan login","success"),location.hash="/login")}catch(e){o("Kesalahan","Gagal menghubungi server","error")}finally{this.view.setButtonLoading("register-btn",!1)}}}},715:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(642);const n={register:async(e,t,s)=>(await fetch(`${a.A.BASE_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:s})})).json(),login:async(e,t)=>(await fetch(`${a.A.BASE_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})).json(),getStories:async e=>(await fetch(`${a.A.BASE_URL}/stories`,{headers:{Authorization:`Bearer ${e}`}})).json(),async addStory({token:e,description:t,image:s,lat:n,lon:i}){const o=new FormData;return o.append("description",t),o.append("photo",s),n&&i&&(o.append("lat",n),o.append("lon",i)),(await fetch(`${a.A.BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:o})).json()}}}}]);